//???????? ???????
#define _XTAL_FREQ 4000000

#include    <htc.h>
#include <stdlib.h>
#include <stdio.h>
#include <string.h>
//?????????? ??????
#define    LCD_RS RD0
#define    LCD_RW RD1
#define    LCD_EN RD2

//????? ???????? ??????
#define LCD_DATA PORTB

//??? ?????????? LCD, ??????? ??????????? ???????????????
#define LCD_STROBE() ((LCD_EN = 1),(LCD_EN = 0))

__CONFIG(WDTDIS & UNPROTECT & MCLREN & LVPDIS & HS);

//??????? ????????
void delay(int value){
	for (int i = 0; i<value*1000; i++){}
}

//??????? ?????? ? 4-? ?????? ??????
void lcd_write(unsigned char c)
{
	delay(4);
	LCD_DATA = ((c >> 4) & 0x0F);
	LCD_STROBE();
	LCD_DATA = (c & 0x0F);
	LCD_STROBE();
}

//??????? ???????
void lcd_clear(void)
{
	LCD_RS = 0;
	lcd_write(0x1);
	delay(4);
}

//??????? ?????? ??????
void lcd_puts(const char * s)
{
	LCD_RS = 1;
	while (*s)
		lcd_write(*s++);
}

//??????? ?????? ?????? ???????
void lcd_putch(char c)
{
	LCD_RS = 1;
	lcd_write(c);
}

//??????????? ? ????????? ???????
void lcd_goto(unsigned char pos)
{
	LCD_RS = 0;
	lcd_write(0x80 + pos);
}

//????????????? ???????, 4-? ?????? ?????
void lcd_init()
{
	//????????? ?????????????? ???????
	//ANSEL = 0x00;
	//??????????? ????? A ? B ?? ?????
	TRISD = 0;
	TRISB = 0;
	LCD_RS = 0;
	LCD_EN = 0;
	LCD_RW = 0;

	delay(15);
	LCD_DATA = 3;
	LCD_STROBE();
	delay(5);
	LCD_STROBE();
	delay(1);
	LCD_STROBE();
	delay(1);
	LCD_DATA = 2;
	LCD_STROBE();

	lcd_write(0x28); // Set interface length
	lcd_write(0xF);  // Display On, Cursor On, Cursor Blink
	lcd_clear();     // Clear screen
	lcd_write(0x6);  // Set entry Mode
}
void main() {
	lcd_init();
	lcd_goto(0x00);	//??????? ?? ?????? ?????       //0x00 - first line
	//lcd_puts("Hello, Vovan!");

        ADCON1 = 0x00;       //adc initonce
	//????????????? ????? ?????????????? ??????? ?? ?????? 2 ? 3 ????? ?
	ANSEL = 0x0C;
	//???? ? ?? ????
	TRISA = 0x0C;
	ADCON0 = 0xCB;       //begin AD conversion on AN2



        char str1[10],str2[10],str3[10];
        int res1,res2,res3;

	for (;;){
            ADCON0 = 0b11001011;       //begin AD conversion on AN2
            while (ADCON0 == 1)        //wait until ADCON0<1> flips to 0
                continue;
            res1 = ADRESH << 2;
            sprintf(str1, "%d", res1);
            
            ADCON0 = 0b11000111;       //begin AD conversion on AN2
            while (ADCON0 == 1)        //wait until ADCON0<1> flips to 0
                continue;
            res2 = ADRESH << 2;
            sprintf(str2, "%d", res2);

            ADCON0 = 0b11001111;       //begin AD conversion on AN2
            while (ADCON0 == 1)        //wait until ADCON0<1> flips to 0
                continue;
            res3 = ADRESH << 2;
            sprintf(str3, "%d", res3);

            strcat(str1," ");
            strcat(str1,str2);
            strcat(str1," ");
            strcat(str1,str3);

            lcd_clear();
            lcd_puts(str1);

            delay(1000);
        }
}
